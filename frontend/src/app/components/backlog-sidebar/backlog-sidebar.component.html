<div class="backlog-sidebar-container">
  <div class="accordion-wrapper">
    <p-accordion
      [multiple]="true"
      [(value)]="expandedPanels"
      class="workspace-accordion"
    >
      <!-- Work Section -->
      <p-accordionpanel [value]="0">
        <p-accordionheader>
          <div class="workspace-header work-header">
            <i class="pi pi-briefcase workspace-icon"></i>
            <span class="workspace-name">Work</span>
            <p-chip
              [label]="workTaskCount().toString()"
              styleClass="workspace-badge"
            />
          </div>
        </p-accordionheader>
        <p-accordioncontent>
          <div
            class="workspace-content"
            cdkDropList
            [cdkDropListData]="workTasks()"
            [cdkDropListConnectedTo]="[
              'today-list',
              'in-progress-list',
              'done-list',
              'personal-backlog-list',
            ]"
            (cdkDropListDropped)="onDrop($event)"
            id="work-backlog-list"
          >
            @if (workTasks().length === 0) {
              <p-message severity="info" [text]="'No work tasks in backlog'" />
            } @else {
              @for (task of workTasks(); track task.id) {
                <div cdkDrag [cdkDragData]="task">
                  <app-task-card
                    [task]="task"
                    variant="compact"
                    [draggable]="true"
                    (taskClick)="showTaskDetails($event)"
                  />
                </div>
              }
            }
          </div>
        </p-accordioncontent>
      </p-accordionpanel>

      <!-- Personal Section -->
      <p-accordionpanel [value]="1">
        <p-accordionheader>
          <div class="workspace-header personal-header">
            <i class="pi pi-home workspace-icon"></i>
            <span class="workspace-name">Personal</span>
            <p-chip
              [label]="personalTaskCount().toString()"
              styleClass="workspace-badge"
            />
          </div>
        </p-accordionheader>
        <p-accordioncontent>
          <div
            class="workspace-content"
            cdkDropList
            [cdkDropListData]="personalTasks()"
            [cdkDropListConnectedTo]="[
              'today-list',
              'in-progress-list',
              'done-list',
              'work-backlog-list',
            ]"
            (cdkDropListDropped)="onDrop($event)"
            id="personal-backlog-list"
          >
            @if (personalTasks().length === 0) {
              <p-message
                severity="info"
                [text]="'No personal tasks in backlog'"
              />
            } @else {
              @for (task of personalTasks(); track task.id) {
                <div cdkDrag [cdkDragData]="task">
                  <app-task-card
                    [task]="task"
                    variant="compact"
                    [draggable]="true"
                    (taskClick)="showTaskDetails($event)"
                  />
                </div>
              }
            }
          </div>
        </p-accordioncontent>
      </p-accordionpanel>
    </p-accordion>
  </div>
</div>

<!-- Create Task Dialog -->
<app-task-form-dialog
  [(visible)]="createTaskDialogVisible"
  [defaultStatus]="TaskStatus.BACKLOG"
  [defaultWorkspace]="taskStateService.selectedWorkspace()"
  (taskSubmitted)="handleTaskSubmitted($event)"
/>

<!-- Edit Task Dialog -->
<app-task-form-dialog
  [(visible)]="taskDetailsDialogVisible"
  [task]="selectedTask()!"
  (taskSubmitted)="handleTaskUpdated($event)"
/>
